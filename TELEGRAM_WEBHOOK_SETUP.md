# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram Webhook

## –ß—Ç–æ —Ç–∞–∫–æ–µ Webhook?

Webhook –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–æ—Ç—É –ø–æ–ª—É—á–∞—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Å–æ–æ–±—â–µ–Ω–∏—è, –∫–æ–º–∞–Ω–¥—ã) –æ—Ç Telegram –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ HTTP –∑–∞–ø—Ä–æ—Å—ã –∫ –≤–∞—à–µ–º—É —Å–µ—Ä–≤–µ—Ä—É.

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Webhook

### 1. –ü–æ–ª—É—á–∏—Ç–µ URL –≤–∞—à–µ–≥–æ webhook endpoint

- **–õ–æ–∫–∞–ª—å–Ω–æ (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏):**
  - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ [ngrok](https://ngrok.com/) –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç—É–Ω–Ω–µ–ª—è
  - –ó–∞–ø—É—Å—Ç–∏—Ç–µ: `ngrok http 3000`
  - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ HTTPS URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: `https://abc123.ngrok.io`)
  - Webhook URL: `https://abc123.ngrok.io/api/telegram/webhook`

- **–ù–∞ Vercel (–ø—Ä–æ–¥–∞–∫—à–Ω):**
  - Webhook URL: `https://your-domain.vercel.app/api/telegram/webhook`
  - –ó–∞–º–µ–Ω–∏—Ç–µ `your-domain.vercel.app` –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ–º–µ–Ω

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook —á–µ—Ä–µ–∑ Telegram Bot API

#### –°–ø–æ—Å–æ–± 1: –ß–µ—Ä–µ–∑ curl

```bash
curl -X POST "https://api.telegram.org/bot8346491967:AAFgpx5alWNAXmsjJsgg8lVC1HgM3aXOopk/setWebhook" \
  -H "Content-Type: application/json" \
  -d '{"url": "https://your-domain.vercel.app/api/telegram/webhook"}'
```

#### –°–ø–æ—Å–æ–± 2: –ß–µ—Ä–µ–∑ BotFather

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/setwebhook`
3. –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞
4. –í–≤–µ–¥–∏—Ç–µ URL: `https://your-domain.vercel.app/api/telegram/webhook`

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

```bash
curl "https://api.telegram.org/bot8346491967:AAFgpx5alWNAXmsjJsgg8lVC1HgM3aXOopk/getWebhookInfo"
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ webhook, –≤–∫–ª—é—á–∞—è –≤–∞—à URL.

## –ß—Ç–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç webhook?

### –ö–æ–º–∞–Ω–¥–∞ /start

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `/start`, –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ–º —Å –∫–Ω–æ–ø–∫–∞–º–∏:
- **üì± –ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º** - –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **üìù –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –æ–Ω–ª–∞–π–Ω** - –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç Web App –¥–ª—è –∑–∞–ø–∏—Å–∏

### –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–∞

–ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º" –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–π –Ω–æ–º–µ—Ä:
- –ë–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–Ω—Ç–∞–∫—Ç —á–µ—Ä–µ–∑ webhook
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∑–∞–ø–∏—Å–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ Web App

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ URL –¥–æ—Å—Ç—É–ø–µ–Ω –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS)
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ endpoint –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{"ok": true}`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `TELEGRAM_BOT_TOKEN` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ

### –û—à–∏–±–∫–∞ 404

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `/api/telegram/webhook`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª `app/api/telegram/webhook/route.ts` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

### –û—à–∏–±–∫–∞ 500

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ—Å—Ç—É–ø–Ω–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
3. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
4. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–º"
5. –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –∫–æ–Ω—Ç–∞–∫—Ç
6. –î–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- Webhook endpoint –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è Telegram
- –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç Telegram (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É IP)
- –¢–æ–∫–µ–Ω –±–æ—Ç–∞ —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
